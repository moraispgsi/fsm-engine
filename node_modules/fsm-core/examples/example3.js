/**
 * Created by Ricardo Morais on 17/04/2017.
 */


require('./../index')('mysql', 'localhost', 'root', 'root', 'mydatabase').then(function (meta) {
    let co = require("co");
    co(function*(){

        let data = yield meta.action.createFSM("myfsm");
        let version = data.version;

        let scxml = `
        <scxml xmlns="http://www.w3.org/2005/07/scxml" version="1.0" datamodel="ecmascript"
    initial="uninitilized">
    <datamodel>
        <data id="date"/>
        <data id="deadlineId"/>
    </datamodel>
    <state id="uninitilized">
        <transition event="initialize" target="running">
            <assign location="date" expr="_event.date"/>
            <assign location="deadlineId" expr="_event.deadLineId"/>
            <send id="state1-timer" event="timeout" delay="10s"/>
        </transition>
    </state>
    <state id="running">
        <transition event="timeout" target="expired">
            <log label="Timeout received!"/>
        </transition>
    </state>
    <state id="expired">
        <onentry>
            <log label="The date has expired!"/>
        </onentry>
    </state>
</scxml>

               `;

        yield meta.action.setScxml(version.dataValues.id, scxml);
        yield meta.action.seal(version.dataValues.id);

    });

});
